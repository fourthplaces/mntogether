[package]
name = "server"
version.workspace = true
edition.workspace = true

[lib]
name = "server_core"
path = "src/lib.rs"

[[bin]]
name = "server"
path = "src/server/main.rs"

[[bin]]
name = "seed_organizations"
path = "src/bin/seed_organizations.rs"

[[bin]]
name = "generate_embeddings"
path = "src/bin/generate_embeddings.rs"

[dependencies]
# Async runtime
tokio = { workspace = true }
async-trait = "0.1"
futures = "0.3"

# Error handling
anyhow = { workspace = true }
thiserror = { workspace = true }

# Serialization
serde = { workspace = true }
serde_json = { workspace = true }

# IDs and timestamps
uuid = { workspace = true }
chrono = { workspace = true }

# Logging
tracing = { workspace = true }
tracing-subscriber = { workspace = true }

# Event-driven architecture
seesaw_core = "0.1.1"
seesaw-testing = "0.1.1"

# Intelligent crawler
intelligent-crawler = { path = "../intelligent-crawler" }

# Authentication
twilio = { path = "../twilio-rs" }
jsonwebtoken = "9"

# Database
sqlx = { workspace = true, features = ["migrate"] }
pgvector = { version = "0.4", features = ["sqlx", "serde"] }

# AI / LLM
rig-core = { workspace = true }

# GraphQL
juniper = { workspace = true }
juniper_axum = { workspace = true }

# HTTP server
axum = { workspace = true, features = ["multipart"] }
tower = { workspace = true }
tower-http = { workspace = true }
tower_governor = "0.4"
hyper = { version = "1", features = ["full"] }

# HTTP client (for Expo)
reqwest = { workspace = true }
urlencoding = "2.1"
url = "2.5"

# Web scraping and search SDKs
firecrawl = "1.2.1"
tavily = "2.1.0"

# Cron jobs
tokio-cron-scheduler = "0.10"

# Static file embedding
rust-embed = "8.0"
mime_guess = "2.0"

# Environment
dotenvy = { workspace = true }

# Content hashing (duplicate detection)
sha2 = { workspace = true }

# Markdown rendering (optional - for display_markdown)
pulldown-cmark = "0.9"
hex = "0.4"

# Builder pattern
typed-builder = "0.20"

# PII Detection and Redaction
regex = "1.10"
lazy_static = "1.4"

[dev-dependencies]
# Testing
tokio-test = "0.4"
test-context = "0.3"
testcontainers = { workspace = true }
testcontainers-modules = { version = "0.11", features = ["postgres", "redis"] }
